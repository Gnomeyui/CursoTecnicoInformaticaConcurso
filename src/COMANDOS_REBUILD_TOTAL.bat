@echo off
chcp 65001 >nul
cls

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ REBUILD TOTAL - CORREรรO DO CRASH LOOP
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM
REM Execute este script para fazer o rebuild completo do app
REM apรณs baixar o projeto atualizado com as correรงรตes do Gemini
REM
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ฅ REBUILD TOTAL - CORREรรO CRASH LOOP (GEMINI)
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

REM Verificar se estรก no diretรณrio correto
if not exist "package.json" (
    echo โ ERRO: Execute este script na raiz do projeto!
    echo    cd C:\Users\SEU_USUARIO\Desktop\ale-rr-top5
    pause
    exit /b 1
)

echo โ Diretรณrio correto detectado
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASSO 1: LIMPAR BUILDS ANTIGOS
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ PASSO 1: Limpando builds antigos...
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โ Removendo dist\
if exist dist rmdir /s /q dist

echo โ Removendo android\app\build\
if exist android\app\build rmdir /s /q android\app\build

echo โ Removendo android\build\
if exist android\build rmdir /s /q android\build

echo โ Removendo android\.gradle\
if exist android\.gradle rmdir /s /q android\.gradle

echo โ Limpeza concluรญda!
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASSO 2: REBUILD REACT (VITE)
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ๏ธ  PASSO 2: Compilando React (Vite)...
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

call npm run build

if errorlevel 1 (
    echo.
    echo โ ERRO: Build do React falhou!
    echo    Verifique os erros acima e tente novamente
    pause
    exit /b 1
)

echo โ Build do React concluรญdo!
echo.

REM Verificar se dist foi criado
if not exist "dist" (
    echo โ ERRO: Pasta dist\ nรฃo foi criada!
    echo    O build pode ter falhado silenciosamente
    pause
    exit /b 1
)

echo โ Pasta dist\ criada com sucesso
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASSO 3: SINCRONIZAR COM ANDROID (CAPACITOR)
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ฑ PASSO 3: Sincronizando com Android (Capacitor)...
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

call npx cap sync android

if errorlevel 1 (
    echo.
    echo โ ERRO: Sincronizaรงรฃo falhou!
    echo    Verifique os erros acima e tente novamente
    pause
    exit /b 1
)

echo โ Sincronizaรงรฃo concluรญda!
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM CONCLUSรO
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ REBUILD CONCLUรDO COM SUCESSO!
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ฏ PRรXIMOS PASSOS:
echo.
echo 1. Abrir Android Studio:
echo    npx cap open android
echo.
echo 2. No Android Studio:
echo    File โ Invalidate Caches โ Restart
echo    (Aguarde reiniciar)
echo.
echo 3. Depois:
echo    Build โ Clean Project
echo    Build โ Rebuild Project
echo    Build โ Build Bundle(s) / APK(s) โ Build APK(s)
echo.
echo 4. No celular:
echo    - Desinstalar versรฃo antiga
echo    - Limpar dados/cache
echo    - Instalar novo APK
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ DOCUMENTAรรO COMPLETA:
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo โ CORRECAO_DEFINITIVA_NATIVA.md
echo โ SOLUCAO_CRASH_FINAL.txt
echo โ REBUILD_COMPLETO_GEMINI.md
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ BOA SORTE! O APP VAI FUNCIONAR! ๐
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
pause
