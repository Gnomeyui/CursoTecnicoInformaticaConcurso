#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ REBUILD TOTAL - CORREรรO DO CRASH LOOP
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#
# Execute este script para fazer o rebuild completo do app
# apรณs baixar o projeto atualizado com as correรงรตes do Gemini
#
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ฅ REBUILD TOTAL - CORREรรO CRASH LOOP (GEMINI)"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Verificar se estรก no diretรณrio correto
if [ ! -f "package.json" ]; then
    echo "โ ERRO: Execute este script na raiz do projeto!"
    echo "   cd C:/Users/SEU_USUARIO/Desktop/ale-rr-top5"
    exit 1
fi

echo "โ Diretรณrio correto detectado"
echo ""

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# PASSO 1: LIMPAR BUILDS ANTIGOS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ PASSO 1: Limpando builds antigos..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

echo "โ Removendo dist/"
rm -rf dist

echo "โ Removendo android/app/build/"
rm -rf android/app/build

echo "โ Removendo android/build/"
rm -rf android/build

echo "โ Removendo android/.gradle/"
rm -rf android/.gradle

echo "โ Limpeza concluรญda!"
echo ""

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# PASSO 2: REBUILD REACT (VITE)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ๏ธ  PASSO 2: Compilando React (Vite)..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

npm run build

if [ $? -ne 0 ]; then
    echo ""
    echo "โ ERRO: Build do React falhou!"
    echo "   Verifique os erros acima e tente novamente"
    exit 1
fi

echo "โ Build do React concluรญdo!"
echo ""

# Verificar se dist foi criado
if [ ! -d "dist" ]; then
    echo "โ ERRO: Pasta dist/ nรฃo foi criada!"
    echo "   O build pode ter falhado silenciosamente"
    exit 1
fi

echo "โ Pasta dist/ criada com sucesso"
echo ""

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# PASSO 3: SINCRONIZAR COM ANDROID (CAPACITOR)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ฑ PASSO 3: Sincronizando com Android (Capacitor)..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

npx cap sync android

if [ $? -ne 0 ]; then
    echo ""
    echo "โ ERRO: Sincronizaรงรฃo falhou!"
    echo "   Verifique os erros acima e tente novamente"
    exit 1
fi

echo "โ Sincronizaรงรฃo concluรญda!"
echo ""

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CONCLUSรO
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ REBUILD CONCLUรDO COM SUCESSO!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ฏ PRรXIMOS PASSOS:"
echo ""
echo "1. Abrir Android Studio:"
echo "   npx cap open android"
echo ""
echo "2. No Android Studio:"
echo "   File โ Invalidate Caches โ Restart"
echo "   (Aguarde reiniciar)"
echo ""
echo "3. Depois:"
echo "   Build โ Clean Project"
echo "   Build โ Rebuild Project"
echo "   Build โ Build Bundle(s) / APK(s) โ Build APK(s)"
echo ""
echo "4. No celular:"
echo "   - Desinstalar versรฃo antiga"
echo "   - Limpar dados/cache"
echo "   - Instalar novo APK"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ DOCUMENTAรรO COMPLETA:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "โ CORRECAO_DEFINITIVA_NATIVA.md"
echo "โ SOLUCAO_CRASH_FINAL.txt"
echo "โ REBUILD_COMPLETO_GEMINI.md"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ BOA SORTE! O APP VAI FUNCIONAR! ๐"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
